name: LLM Code Review

on:
  pull_request:
    types: [opened, synchronize]

# æ˜ç¡®å£°æ˜æƒé™ï¼ˆä½ å·²ç»åŠ è¿‡ï¼Œè¿™é‡Œä¿ç•™ï¼‰
permissions:
  contents: read
  pull-requests: write

jobs:
  review:
    runs-on: ubuntu-latest

    steps:
      # 1. æ‹‰ä»£ç ï¼ˆå¿…é¡»ï¼‰
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. ğŸ” Debugï¼šæ£€æŸ¥ OPENAI_API_KEY æ˜¯å¦çœŸçš„æ³¨å…¥
      - name: Debug OPENAI_API_KEY presence
        shell: bash
        run: |
          echo "==== DEBUG OPENAI_API_KEY ===="
          if [ -z "${{ secrets.OPENAI_API_KEY }}" ]; then
            echo "âŒ OPENAI_API_KEY is EMPTY"
            echo "This means GitHub did NOT inject the secret into this run."
            exit 1
          else
            echo "âœ… OPENAI_API_KEY is PRESENT"
            echo "Length: ${#OPENAI_API_KEY}"
          fi

      # 3. æ­£å¼è¿è¡Œ LLM Code Reviewerï¼ˆæœ€å°é…ç½®ï¼Œé¿å…å¹²æ‰°ï¼‰
      - name: Run LLM Code Reviewer
        uses: tusgino/llm-code-reviewer@v1
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
